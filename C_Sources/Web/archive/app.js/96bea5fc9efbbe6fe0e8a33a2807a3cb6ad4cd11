/*96bea5fc9efbbe6fe0e8a33a2807a3cb6ad4cd11*/Ext.define("Igor.model.Notification",{extend:"Ext.data.Model",config:{fields:["notification_id","userid","username","avatar","action","object","objectid","date","is_read"]}});Ext.define("Igor.model.User",{extend:"Ext.data.Model",config:{idProperty:"userid",identifier:{type:"uuid"},fields:[{name:"userid",type:"int"},{name:"fullname",type:"string"},{name:"avatar",type:"string"},{name:"studentid",type:"int"},{name:"email",type:"string"},{name:"group",type:"string"},{name:"course",type:"string"},{name:"loggedIn",type:"boolean",defaultValue:false}]}});Ext.define("Igor.model.Task",{extend:"Ext.data.Model",config:{fields:["class_code","class_id","subject_name","num_of_day","period","subject_code","session_start","total_session","teacher_name","location"]}});Ext.define("Igor.model.Classdetail",{extend:"Ext.data.Model",config:{fields:["class_id","class_code","subject_name","num_of_day","period","subject_code","session_start","total_session","teacher_name","location"],}});Ext.define("Igor.model.Classproject",{extend:"Ext.data.Model",config:{fields:["projectid","name","description"],}});Ext.define("Igor.model.Classtask",{extend:"Ext.data.Model",config:{fields:["id","name","status","start_time","end_time","repeat_date","location","note","class_subject","owner","test","date",],}});Ext.define("Igor.model.Projectjob",{extend:"Ext.data.Model",config:{fields:["jobid","name","status","start_time","end_time","repeat_date","location","note"]}});Ext.define("Igor.model.Projectmember",{extend:"Ext.data.Model",config:{fields:["userid","username","fullname","password","avatar","studentid","email","group","course"],proxy:{type:"ajax",url:"data/job_project.json",reader:{type:"json",rootProperty:"projects.members"}}}});Ext.define("Igor.model.Classuser",{extend:"Ext.data.Model",config:{fields:["userid","username","fullname","password","avatar","studentid","email","group","course"]}});Ext.define("Igor.model.Profile",{extend:"Ext.data.Model",config:{idProperty:"userid",identifier:{type:"uuid"},fields:[{name:"userid",type:"int"},{name:"fullname",type:"string"},{name:"avatar",type:"string"},{name:"studentid",type:"int"},{name:"email",type:"string"},{name:"group",type:"string"},{name:"course",type:"string"}]}});Ext.define("Igor.model.Subject",{extend:"Ext.data.Model",config:{fields:["subject_id","subject_name","subject_code","class_count","note",],}});Ext.define("Igor.model.ClassOfSubject",{extend:"Ext.data.Model",config:{fields:["term","id","location","class_code","duration","is_finished","teacher","subject"],}});Ext.define("Igor.view.authenticate.Register",{extend:"Ext.form.Panel",xtype:"registerForm",config:{title:"Register",items:[{xtype:"image",cls:"logo",ui:"light",width:100,height:45,src:"resources/images/Igor.png"},{xtype:"fieldset",title:"Register",instructions:"Email and Password are required.",items:[{xtype:"textfield",label:"Full Name",name:"fullname"},{xtype:"emailfield",label:"Email",name:"email"},{xtype:"passwordfield",label:"Password",name:"password"},{xtype:"textfield",label:"Student ID",name:"studentid"},{xtype:"datepickerfield",name:"dob",label:"DOB",value:new Date("3/19/1989"),picker:{yearFrom:1989}},{xtype:"selectfield",label:"Course",name:"course",valueField:"course",displayField:"title",store:{data:[{course:"52",title:"Course 52"},{course:"53",title:"Course 53"},{course:"54",title:"Course 54"},{course:"55",title:"Course 55"},{course:"56",title:"Course 56"}]}},{xtype:"selectfield",label:"Group",name:"group",valueField:"groupid",displayField:"title",store:{data:[{groupid:"HTTT",title:"HTTT"},{groupid:"TTM",title:"TTM"},{groupid:"KHMT",title:"KHMT"},{groupid:"KTMT",title:"KTMT"},{groupid:"CNPM",title:"CNPM"}]}}]},{xtype:"button",text:"Register",itemId:"submitRegisterBtn",ui:"confirm",margin:"5",}]}});Ext.define("Igor.controller.ClassDetails",{extend:"Ext.app.Controller",views:["task.ClassDetails"],init:function(){},config:{control:{},routes:{"tasks/:id":"doClassDetail"},refs:{classDetailsForm:"classDetailsForm",classProjectList:"classDetailsForm #classProjectList"},before:{}},doClassDetail:function(a){},getAllProjectsByClass:function(a){}});Ext.define("Igor.controller.SubjectDetails",{extend:"Ext.app.Controller",views:["task.SubjectDetails"],init:function(){},config:{control:{classesListForm:{itemtap:"doAddNewClassToUser"}},routes:{"subjectDetails/:id":"doSubjectDetails"},refs:{subjectDetailsForm:"subjectDetailsForm",subjectDetailsPanel:"subjectDetailsForm #subjectDetailsPanel",classesListForm:"subjectDetailsForm #selectClassesList"},before:{}},doSubjectDetails:function(a){Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/subject/call/jsonp/get_subject_detail/",params:{id:a},disableCaching:false,success:function(c,d){var e=Ext.getStore("SubjectDetails"),b={};e.removeAll();e.sync();if(c.status=="OK"&&c.message!=""){Ext.Array.each(c.message,function(f){b=Ext.create("Igor.model.Subject",f);e.add(b);e.sync()})}}});this.getAllClassesBySubject(a)},getAllClassesBySubject:function(a){Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/class_subject/call/jsonp/get_classes_by_subject/",params:{subject_id:a},disableCaching:false,success:function(b,c){var e=Ext.getStore("SubjectClasses"),d={};e.removeAll();e.sync();if(b.status=="OK"&&b.message!=""){Ext.Array.each(b.message,function(f){d=Ext.create("Igor.model.ClassOfSubject",f);e.add(d);e.sync()})}}})},doAddNewClassToUser:function(d,b,e,a){var c=Ext.getStore("Users").getAt(0).get("userid");Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/class_subject/call/jsonp/add_class_to_user/",params:{class_id:a.get("id"),user_id:c},disableCaching:false,success:function(f,g){if(f.status=="OK"&&f.message!=""){Ext.Msg.alert("Success!")}else{Ext.Msg.alert("Failed! Try again, please!")}}})}});Ext.define("Igor.store.Notifications",{extend:"Ext.data.Store",config:{model:"Igor.model.Notification",pageSize:5,autoLoad:true,sorters:"date",grouper:{groupFn:function(a){return a.get("!username")}}}});Ext.define("Igor.store.Users",{extend:"Ext.data.Store",requires:["Ext.data.proxy.LocalStorage"],config:{model:"Igor.model.User",autoSync:true,proxy:{type:"localstorage",id:"usersStorage"},autoload:true,}});Ext.define("Igor.store.Profiles",{extend:"Ext.data.Store",config:{model:"Igor.model.Profile",pageSize:5,autoLoad:true,sorters:"date",grouper:{groupFn:function(a){return a.get("!username")}},}});Ext.define("Igor.store.Tasks",{extend:"Ext.data.Store",config:{model:"Igor.model.Task",pageSize:5,autoLoad:true,sorters:"session_start",groupField:"period",groupDir:"DESC",grouper:{groupFn:function(a){return a.get("!period")}},}});Ext.define("Igor.store.Classdetails",{extend:"Ext.data.Store",config:{model:"Igor.model.Classdetail",autoLoad:true,}});Ext.define("Igor.store.Classprojects",{extend:"Ext.data.Store",config:{model:"Igor.model.Classproject",autoLoad:true,}});Ext.define("Igor.store.Classtasks",{extend:"Ext.data.Store",config:{model:"Igor.model.Classtask",autoLoad:true,}});Ext.define("Igor.store.Projectmembers",{extend:"Ext.data.Store",config:{model:"Igor.model.Projectmember",autoLoad:true,}});Ext.define("Igor.store.Projectjobs",{extend:"Ext.data.Store",config:{model:"Igor.model.Projectjob",autoLoad:true,}});Ext.define("Igor.store.Classusers",{extend:"Ext.data.Store",config:{model:"Igor.model.Classuser",pageSize:5,autoLoad:true,sorters:"date",grouper:{groupFn:function(a){return a.get("!username")}}}});Ext.define("Igor.store.Subjects",{extend:"Ext.data.Store",config:{model:"Igor.model.Subject",autoLoad:true,}});Ext.define("Igor.store.SubjectDetails",{extend:"Ext.data.Store",config:{model:"Igor.model.Subject",autoLoad:true,}});Ext.define("Igor.store.SubjectClasses",{extend:"Ext.data.Store",config:{model:"Igor.model.ClassOfSubject",autoLoad:true,}});Ext.define("Igor.view.notification.News",{extend:"Ext.navigation.View",xtype:"updatesListForm",requires:["Ext.List"],config:{autoDestroy:true,navigationBar:{defaults:{hideAnimation:Ext.os.is.Android?false:{type:"fadeOut",duration:200},showAnimation:Ext.os.is.Android?false:{type:"fadeIn",duration:200}},items:[{xtype:"image",docked:"top",ui:"light",width:100,height:45,src:"resources/images/Igor.png"},{xtype:"button",itemId:"refreshNewsButton",iconCls:"time_repeat",iconMask:true,ui:"plain",align:"right"}]},items:[{xtype:"list",itemId:"updateList",title:"News",cls:"x-feeds",disclosure:true,onItemDisclosure:true,limit:5,disableSelection:true,plugins:[{xclass:"Ext.plugin.ListPaging"},{xclass:"Ext.plugin.PullRefresh"}],store:"Notifications",itemTpl:['<div class="feed" style="background-image:url(resources/images/headshots/{avatar});"></div>',"{username}",'<span>{action} <a href="">{object}</a></span>',].join(""),},]}});Ext.define("Igor.view.task.AddClass",{extend:"Ext.Container",xtype:"addclassForm",requires:["Ext.List","Igor.store.Classdetails"],config:{title:"All class(es) of ",iconCls:"team",layout:"vbox",autoDestroy:true,items:[{xtype:"list",ui:"round",itemId:"selectClassesList",cls:"x-feeds",flex:1,disclosure:true,limit:5,listeners:{itemtap:function(c,b,d,a){}},emptyText:'<div style="margin-top: 20px; text-align: center">No Matching Subject</div>',plugins:[{xclass:"Ext.plugin.ListPaging"},{xclass:"Ext.plugin.PullRefresh"}],store:"Classdetails",items:[{xtype:"listitemheader",cls:"dark",html:"Classes",}],},]}});Ext.define("Igor.view.about.About",{extend:"Ext.Panel",xtype:"aboutPage",config:{autoDestroy:true,styleHtmlContent:true,scrollable:true,contentEl:"about",items:[{docked:"top",xtype:"toolbar",title:"About Igor",}]}});Ext.define("Igor.view.task.New",{extend:"Ext.Container",xtype:"newTask",requires:["Ext.List","Igor.store.Subjects"],config:{title:"New Scheduler",iconCls:"team",layout:"vbox",autoDestroy:true,items:[{xtype:"fieldset",margin:15,items:[{xtype:"searchfield",itemId:"subjectSearch",flex:1,scrollable:false,height:"42px",placeHolder:"Search...",}]},{xtype:"list",ui:"round",itemId:"subjectList",cls:"x-feeds",flex:1,disclosure:true,limit:5,emptyText:'<div style="margin-top: 20px; text-align: center">No Matching Subject</div>',plugins:[{xclass:"Ext.plugin.ListPaging"},{xclass:"Ext.plugin.PullRefresh"}],store:"Subjects",itemTpl:['<div class="feed" style="background-image:url(resources/images/subject-icon.png);"></div>',"{subject_name}","<span>ID: {subject_code} - {class_count} class(es)</span>",].join(""),items:[{xtype:"listitemheader",cls:"dark",html:"Subject List"}],},]}});Ext.define("Igor.utility.ux.PathMenu",{mixins:["Ext.mixin.Observable"],xtype:"pathmenu",requires:["Ext.Button","Ext.util.DelayedTask"],config:{cls:"x-ux-pathmenu",top:null,bottom:null,right:null,left:null,height:30,width:30,items:[],radius:110,menuButtonDefault:{iconCls:"add",ui:"pathmenu",iconMask:true,isOpen:false,pathButtonType:"menu",cls:"menubutton"},menuItemDefault:{iconMask:true,ui:"pathmenu",isActive:false,pathButtonType:"menuitem"},menuItems:null,menuTrigger:null},constructor:function(c){this.initConfig(c);var d=this,b=[],a={xtype:"button",top:this.getTop(),bottom:this.getBottom(),right:this.getRight(),left:this.getLeft(),height:this.getHeight(),width:this.getWidth()},e=this.getMenuButtonDefault(),f=this.getMenuItemDefault();Ext.each(c.items,function(h,g){var i=Ext.apply(h,f,a);Ext.apply(i,{handler:d.onMenuItemButtonTap,scope:d});b.push(h);delete (h)},this);b.push(Ext.apply({handler:d.onMenuButtonTap,scope:d},e,a));Ext.Viewport.add(b)},onMenuItemButtonTap:function(b){var c=this,a=Ext.ComponentQuery.query("button[pathButtonType=menu]")[0];b.addCls("tapped");c.close(a);b.fireEvent("itemtap",c,b)},onMenuButtonTap:function(a){if(!a.isOpen){this.open(a)}else{this.close(a)}},open:function(d){var c=Ext.ComponentQuery.query("button[pathButtonType=menuitem]"),b=d.getBottom(),f=d.getLeft(),a=110,e=c.length-1;angle=180/e;d.replaceCls("close","open");Ext.each(c,function(i,h){i.addCls("menuitembutton");i.replaceCls("close","open");var k=(180-(angle*(e-h))),j=Math.PI/180,l=j*k,g=Math.round(Math.cos(l)*a),m=Math.round(Math.sin(l)*a);i.setLeft(f+g);i.setBottom(b+m)});d.isOpen=true},close:function(b){var a=Ext.ComponentQuery.query("button[pathButtonType=menuitem]");b.replaceCls("open","close");Ext.each(a,function(f,d,h,g){b=Ext.ComponentQuery.query("button[pathButtonType=menu]")[0];if(f.getCls().indexOf("tapped")===-1){f.replaceCls("open","close");f.setLeft(b.getLeft());f.setBottom(b.getBottom())}else{var c=Ext.create("Ext.util.DelayedTask",function(){f.removeCls("menuitembutton");f.setLeft(b.getLeft());f.setBottom(b.getBottom());f.removeCls("tapped")});c.delay(900)}});b.isOpen=false}});Ext.define("Igor.utility.ux.AccordionList",{alternateClassName:"Ext.AccordionList",extend:"Ext.Container",xtype:"accordionlist",requires:["Ext.data.Store","Ext.dataview.DataView","Ext.Anim","Ext.XTemplate","Ext.data.NodeStore","Ext.data.TreeStore"],config:{cls:Ext.baseCSSPrefix+"accordion-list",layout:{type:"fit"},store:null,displayField:"text",listScrollable:true,headerItemTpl:['<div style="background-color:#fff;',' min-height: 2.6em; padding: 0.4em 0.2em;">','<tpl if="this.isExpanded(values)">','<span class="x-button x-button-plain">','<span class="x-button-icon arrow_down x-icon-mask"',' style="margin-right:0.4em;"></span>','<span style="color:#00bbe8;">{text}</span>',"</span>","<tpl else>",'<span class="x-button x-button-plain">','<span class="x-button-icon arrow_right x-icon-mask"',' style="margin-right:0.4em;"></span>','<span style="color:#00bbe8;">{text}</span>',"</span>","<tpl>","</div>"].join(""),contentItemTpl:['<div style="background-color:#fff;'," min-height: 2.6em; padding: 0.65em 0.8em;",' border-bottom: 1px solid #dedede;">',"{text}","</div>"].join(""),defaultExpanded:false,useAnimation:true,list:null},initialize:function(){this.doInitialize();this.callParent(arguments)},doInitialize:function(){if(this.getDefaultExpanded()){this.doAllExpanded()}},doAllExpanded:function(){var c=this.getList(),a=c.getStore();function b(d){d.expand();if(!d.isLeaf()){d.childNodes.forEach(b,this)}}a.each(b,this)},updateStore:function(a,d){var b=this.getList(),c;if(!b){c=new Ext.XTemplate('<tpl if="leaf">','<div class="accordion-list-content">',this.getContentItemTpl(),"</div>","<tpl else>",'<div class="accordion-list-header">',this.getHeaderItemTpl(),"</div>","</tpl>",{isExpanded:function(e){return e.expanded}});b=Ext.create("Ext.dataview.DataView",{itemTpl:c});b.on("itemtap",this.onItemTap,this);this.setList(b);b.setScrollable(this.getListScrollable());this.add(b)}b.setStore(a)},updateListScrollable:function(a,c){var b=this.getList();if(b){b.setScrollable(a)}},onItemTap:function(f,c,h,a,g){var b=f.getStore(),d=b.getAt(c);this.fireEvent("itemtap",this,f,c,h,a,g);if(d.isLeaf()){this.fireEvent("leafitemtap",f,c,h,a,g)}else{if(d.isExpanded()){d.collapse()}else{d.expand(false,this.onExpand,this)}}},onExpand:function(){if(!this.getUseAnimation()){return}var a=this.getTargetItems()},getTargetItems:function(){var f=Ext.query("."+this.getCls()+" .x-dataview-item"),c=false,a=[],e;for(var b=0;b<f.length;b++){e=Ext.get(f[b]);if(e.hasCls("x-item-selected")){c=true;continue}if(c){var d=e.down(".accordion-list-content");if(d){a.push(d)}else{break}}}return a}});Ext.define("Igor.view.task.SubjectDetails",{extend:"Ext.Container",xtype:"subjectDetailsForm",requires:["Ext.List","Igor.store.Classdetails"],config:{title:"Subject Details ",iconCls:"team",layout:"vbox",autoDestroy:true,items:[{xtype:"listitemheader",cls:"dark",html:"Subject Details"}],items:[{xtype:"dataview",itemId:"subjectDetailsPanel",name:"subjectDetailsPanel",flex:2,scrollable:true,store:"SubjectDetails",itemTpl:['<div class="x-container x-form-fieldset nonEditable" style="padding: 1em;">','<div class="x-docking-vertical">','<div class="x-body">','<div class="x-inner x-form-fieldset-inner">','<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important;">',"<span>Name</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-text" type="text" value="{subject_name}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field x-field-text x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Code</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="email" value="{subject_code}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Note</span>","</div>",'<div class="x-component-outer">','<divclass="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="text" value="{note}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"].join(""),},{xtype:"list",ui:"round",itemId:"selectClassesList",cls:"x-feeds",flex:1,disclosure:true,limit:5,emptyText:'<div style="margin-top: 20px; text-align: center">No Matching Subject</div>',plugins:[{xclass:"Ext.plugin.ListPaging"},{xclass:"Ext.plugin.PullRefresh"}],store:"SubjectClasses",itemTpl:['<div class="feed" style="background-image:url(resources/images/subject-icon.png);"></div>',"{class_code}","<span>Location: {location} - Teacher: {teacher}</span>","<span>Duration: {duration} weeks - Term: {term}</span>",].join(""),items:[{xtype:"listitemheader",cls:"dark",html:"Classes List of Subject",}],}],}});Ext.define("Igor.view.profile.Edit",{extend:"Ext.form.Panel",xtype:"profileEdit",config:{title:"Edit",layout:"vbox",items:[{xtype:"fieldset",title:"Edit",instructions:"Input valid Student ID and Email.",items:[{xtype:"textfield",label:"Full Name",name:"fullname"},{xtype:"textfield",label:"Student ID",name:"studentid"},{xtype:"selectfield",label:"Course",name:"course",valueField:"course",displayField:"title",store:{data:[{course:"52",title:"Course 52"},{course:"53",title:"Course 53"},{course:"54",title:"Course 54"},{course:"55",title:"Course 55"},{course:"56",title:"Course 56"}]}},{xtype:"selectfield",label:"Group",name:"group",valueField:"groupid",displayField:"title",store:{data:[{groupid:"HTTT",title:"HTTT"},{groupid:"TTM",title:"TTM"},{groupid:"KHMT",title:"KHMT"},{groupid:"KTMT",title:"KTMT"},{groupid:"CNPM",title:"CNPM"}]}},{xtype:"textfield",label:"Avatar URL",name:"avatarPath"}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",text:"Save",ui:"confirm",itemId:"saveUpdatedProfileBtn",scope:this,},{xtype:"spacer"},{xtype:"button",text:"Reset",ui:"action",handler:function(){var a=Ext.ComponentQuery.query("#profileEdit.form")[0];a.reset()}}]}]}});Ext.define("Igor.view.MultiSelect",{extend:"Ext.field.Select",alias:"widget.multiselectfield",xtype:"multiselectfield",usePicker:false,getTabletPicker:function(){var a=this.getDefaultTabletPickerConfig();if(!(this.listPanel)){this.listPanel=Ext.create("Ext.Panel",Ext.apply({centered:true,modal:true,cls:Ext.baseCSSPrefix+"select-overlay",layout:"fit",hideOnMaskTap:false,items:{xtype:"list",mode:"MULTI",store:this.getStore(),itemTpl:'<span class="x-list-label">{'+this.getDisplayField()+"}</span>",listeners:{select:this.onListSelect,itemtap:this.onListTap,hide:this.onListHide,scope:this},items:{xtype:"button",text:"Done",ui:"action",height:"20px",width:"50%",docked:"bottom",style:"margin-top: 10px; margin-bottom: 10px; margin-left: auto; margin-right: auto;",listeners:{tap:this.onButtonTap,scope:this}}}},a))}return this.listPanel},applyValue:function(c){var a=c,b=new Array(),d=new Array();d=(c==null?"":c.split(","));if((c!=null)&&c.trim().localeCompare("")){for(v=0;v<d.length;v++){item=this.getStore().find(this.getValueField(),d[v],null,null,null,true);b.push(this.getOptions()[item].get(this.getDisplayField()))}}this.element.dom.lastChild.firstChild.firstChild.value=b.join(", ");return a},updateValue:function(b,a){this.previousRecord=a;this.record=b;this.fireEvent("change",this,b,a)},getValue:function(){var a=this.record;return(a)},showPicker:function(){if(this.getStore().getCount()===0){return}if(this.getReadOnly()){return}this.isFocused=true;if(this.getUsePicker()){var d=this.getPhonePicker(),a=this.getName(),h={};h[a]=this.record.get(this.getValueField());d.setValue(h);if(!d.getParent()){Ext.Viewport.add(d)}d.show()}else{var f=this.getTabletPicker(),e=f.down("list"),i=e.getStore(),c=new Array(),k=(this.getValue()==null?"":this.getValue().split(",")),j=0,g=k.length;if(!f.getParent()){Ext.Viewport.add(f)}for(j=0;j<g;j++){c.push(k[j])}j=0;for(j=0;j<g;j++){var b=i.findRecord(this.getValueField(),c[j],0,true,false,false);e.select(b,true,false)}f.showBy(this.getComponent());f.down("list").show()}},onListSelect:function(b,a){},onListTap:function(){},onButtonTap:function(){this.setValue("");this.listPanel.down("list").hide();this.listPanel.hide({type:"fade",out:true,scope:this})},onListHide:function(d,c){var b=this,g=this.listPanel.down("list").selected.items,f=new Array(),a=0,e=g.length;for(a=0;a<e;a++){if(g[a].data[this.getDisplayField()]){f.push(g[a].data[this.getValueField()])}}if(f.length>0){b.setValue(f.join(","));this.listPanel.down("list").deselectAll()}else{b.setValue(null)}}});Ext.define("Igor.view.task.ClassTaskDetails",{extend:"Ext.Container",xtype:"classTaskDetailsForm",itemId:"classTaskDetailsForm",requires:["Ext.List","Igor.store.Classtasks"],config:{layout:"vbox",cls:"userInfo",title:"Job Detail",items:[{xtype:"dataview",itemId:"taskDetailPanel",flex:1,scrollable:true,store:"Classtasks",itemTpl:['<div class="header">','   <div class="avatar" style="background-image:url(resources/images/task-icon.png);"></div>',"   <h3>{name}</h3>","   <h4>{location}</h4>","</div>",'<div class="x-container x-form-fieldset nonEditable" style="padding: 1em;">','<div class="x-docking-vertical">','<div class="x-body">','<div class="x-inner x-form-fieldset-inner">','<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important;">',"<span>Start Time</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-text" type="text" value="{start_time}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field x-field-text x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>End Time</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="email" value="{end_time}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Note</span>","</div>",'<div class="x-component-outer">','<divclass="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="text" value="{note}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"].join(""),},{xtype:"toolbar",docked:"bottom",items:[{text:"Mark Completed",ui:"confirm",scope:this,handler:function(){}},{xtype:"spacer"},{text:"Mark Incompeleted",ui:"decline",handler:function(){}}]}]}});Ext.define("Igor.utility.picker.Time",{extend:"Ext.picker.Picker",xtype:"timepicker",config:{increment:5,minHours:0,maxHours:23,hoursTitle:"Hours",minutesTitle:"Minutes",slots:[]},setValue:function(d,c){var a=this.getInitialConfig().increment,b;if(Ext.isDate(d)){d={hours:d.getHours(),minutes:d.getMinutes()}}b=d.minutes%a;if(b>0){d.minutes=Math.round(d.minutes/a)*a}this.callParent([d,c])},getValue:function(){var b=this.callParent(arguments),a=new Date();b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.hours,b.minutes);return b},applySlots:function(c){var d=this,a=d.createHoursSlot(),b=d.createMinutesSlot();return[a,b]},createHoursSlot:function(){var c=this,j=c.getInitialConfig(),e=j.hoursTitle,d=j.minHours,b=j.maxHours,f=[],g;for(var a=d;a<=b;a++){var h=(a<10)?("0"+a):a;f.push({text:h,value:a})}g={name:"hours",align:"center",title:e,data:f,flex:1};return g},createMinutesSlot:function(){var d=this,e=d.getInitialConfig(),g=e.minutesTitle,a=e.increment,c=[],h;for(var b=0;b<60;b+=a){var f;f=(b<10)?("0"+b):b;c.push({text:f,value:b})}h={name:"minutes",align:"center",title:g,data:c,flex:1};return h}});Ext.define("Igor.view.task.JobDetails",{extend:"Ext.Container",xtype:"jobDetailsForm",itemId:"jobDetailsForm",requires:["Ext.List","Igor.store.Projectjobs"],config:{layout:"vbox",cls:"userInfo",title:"Job Detail",items:[{xtype:"dataview",itemId:"jobDetailPanel",flex:1,scrollable:true,store:"Classtasks",itemTpl:['<div class="header">','   <div class="avatar" style="background-image:url(resources/images/task-icon.png);"></div>',"   <h3>{name}</h3>","   <h4>{location}</h4>","</div>",'<div class="x-container x-form-fieldset nonEditable" style="padding: 1em;">','<div class="x-docking-vertical">','<div class="x-body">','<div class="x-inner x-form-fieldset-inner">','<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important;">',"<span>Start Time</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-text" type="text" value="{start_time}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field x-field-text x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>End Time</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="email" value="{end_time}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Note</span>","</div>",'<div class="x-component-outer">','<divclass="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="text" value="{note}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"].join(""),},{xtype:"toolbar",docked:"bottom",items:[{text:"Mark Completed",xtype:"button",itemId:"markCompletedBtn",ui:"confirm",},{xtype:"spacer"},{text:"Delete",xtype:"button",itemId:"deleteJobBtn",ui:"confirm",}]}]},initialize:function(){var a=Ext.data.StoreManager.lookup("Projectjobs");a.load({callback:function(c,b,d){},scope:this})}});Ext.define("Igor.view.authenticate.Authenticate",{extend:"Ext.navigation.View",xtype:"authenForm",requires:["Igor.view.authenticate.Register"],config:{items:[{xtype:"formpanel",itemId:"loginForm",title:"Login",iconCls:"team",layout:"vbox",items:[{xtype:"image",cls:"logo",ui:"light",width:100,height:45,src:"resources/images/Igor.png"},{xtype:"fieldset",title:"Login",instructions:"Email and Password are required.",items:[{xtype:"emailfield",label:"Email",name:"email"},{xtype:"passwordfield",label:"Password",name:"password"}]},{xtype:"button",text:"Login",itemId:"submitBtn",ui:"confirm",margin:"5",},{xtype:"button",ui:"decline",itemId:"registerBtn",text:"Register",margin:"5",}]}]}});Ext.define("Igor.view.profile.Profile",{extend:"Ext.navigation.View",xtype:"userDetailsForm",requires:["Ext.List","Igor.store.Users","Igor.utility.ux.PathMenu","Igor.view.profile.Edit",],config:{autoDestroy:true,navigationBar:{defaults:{hideAnimation:Ext.os.is.Android?false:{type:"fadeOut",duration:200},showAnimation:Ext.os.is.Android?false:{type:"fadeIn",duration:200}},items:[{xtype:"button",itemId:"logoutButton",iconCls:"reply",iconMask:true,ui:"plain",align:"right",handler:function(){var b=Ext.getStore("Users");b.removeAll();b.sync();Ext.Viewport.setActiveItem(Ext.create("Igor.view.authenticate.Authenticate"),{type:"slide"});var h=new RegExp("(?:^|\\s)x-button-pathmenu(?:$|\\s)");var a=new RegExp("(?:^|\\s)x-layout-card-container(?:$|\\s)");var f=document.getElementsByTagName("div");var g=[];var c=[];var d;for(var e=0;(d=f[e])!=null;e++){var j=d.className;if(j&&j.indexOf("x-button-pathmenu")!=-1&&h.test(j)){c.push(d)}else{if(j.indexOf("x-layout-card-container")!=-1&&a.test(j)){g.push(d)}}}for(var e=0;e<c.length;e++){g[0].removeChild(c[e])}}},{xtype:"button",itemId:"editProfileButton",iconCls:"compose",iconMask:true,ui:"plain",align:"right",handler:function(){var a=this.up("navigationview");a.push({xtype:"profileEdit"});this.hide()}}]},items:[{xtype:"container",layout:"vbox",cls:"userInfo",title:"Profile",items:[{xtype:"dataview",flex:1,scrollable:true,store:"Users",itemTpl:['<div class="header">','   <div class="avatar" style="background-image:url(resources/images/headshots/{avatar});"></div>',"   <h3>{fullname}</h3>","   <h4>{group} - Course {course}</h4>","</div>",'<div class="x-container x-form-fieldset nonEditable" style="padding: 1em;">','<div class="x-docking-vertical">','<div class="x-body">','<div class="x-inner x-form-fieldset-inner">','<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important;">',"<span>Student ID</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-text" type="text" value="{studentid}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field x-field-text x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Email</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="email" value="{email}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"].join("")}]}]}});Ext.define("Igor.view.task.NewProject",{extend:"Ext.form.Panel",xtype:"newProjectForm",itemId:"newProjectForm",requires:["Igor.store.Classusers","Igor.view.MultiSelect"],config:{title:"New Project",layout:"vbox",classid:null,items:[{xtype:"fieldset",title:"New Project",instructions:"Enter Required Information.",items:[{xtype:"textfield",label:"Name",name:"name"},{xtype:"textfield",label:"Description",name:"description"},{xtype:"multiselectfield",usePicker:false,itemId:"userListField",label:"Select Member",name:"members",valueField:"userid",displayField:"fullname",}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",text:"Save",itemId:"saveProjectBtn",ui:"confirm",},{xtype:"spacer"},{text:"Reset",handler:function(){Ext.getCmp("newProjectForm").reset()}}]}]}});Ext.define("Igor.utility.picker.TimePicker",{extend:"Ext.field.DatePicker",xtype:"timepickerfield",requires:["Igor.utility.picker.Time"],config:{dateFormat:"H:i",picker:true},applyValue:function(d){if(!Ext.isDate(d)&&!Ext.isObject(d)){d=null}if(Ext.isObject(d)){var b=new Date(),c=d.year||b.getFullYear(),e=d.month||b.getMonth(),a=d.day||b.getDate();d=new Date(c,e,a,d.hours,d.minutes)}return d},applyPicker:function(a){a=Ext.factory(a,"Igor.utility.picker.Time");a.setHidden(true);Ext.Viewport.add(a);return a},updatePicker:function(a){a.on({scope:this,change:"onPickerChange",hide:"onPickerHide"});a.setValue(this.getValue());return a}});Ext.define("Igor.view.task.NewClassTask",{extend:"Ext.form.Panel",xtype:"newClassTaskForm",itemId:"newClassTaskForm",requires:["Igor.utility.picker.TimePicker"],config:{title:"New Class Task",layout:"vbox",items:[{xtype:"fieldset",title:"New Class Task",instructions:"Enter Required Information.",items:[{xtype:"textfield",label:"Name",name:"name"},{xtype:"textfield",label:"Location",name:"location"},{xtype:"textareafield",label:"Note",name:"note",height:90},{xtype:"datepickerfield",name:"startdate",label:"Start Date",value:new Date(),picker:{yearFrom:2000}},{xtype:"timepickerfield",label:"Start Time",value:new Date(),name:"starttime",picker:{height:300,}},{xtype:"datepickerfield",name:"enddate",label:"Deadline Date",value:new Date(),picker:{yearFrom:2000}},{xtype:"timepickerfield",label:"Deadline Time",value:new Date(),name:"endtime",picker:{height:300,}}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",text:"Save",itemId:"saveClassTaskBtn",ui:"confirm",},{xtype:"spacer"},{text:"Reset",handler:function(){Ext.getCmp("newClassTaskForm").reset()}}]}]}});Ext.define("Igor.view.task.ProjectDetails",{extend:"Ext.Container",xtype:"projectDetailsForm",itemId:"projectDetailsForm",requires:["Ext.List","Igor.view.task.JobDetails","Igor.store.Classprojects","Igor.store.Projectmembers","Igor.store.Projectjobs"],config:{layout:"vbox",cls:"userInfo",title:"Project Detail",items:[{xtype:"dataview",itemId:"projectDetailPanel",height:"97px",flex:2,scrollable:false,store:"Classprojects",itemTpl:['<div class="header">','   <div class="avatar" style="background-image:url(resources/images/project_icon.png);"></div>',"   <h3>{name}</h3>","   <h4>{description}</h4>","</div>"].join(""),},{xtype:"list",itemId:"projectMemberList",store:"Projectmembers",disclosure:true,onItemDisclosure:true,flex:1,cls:"x-feeds",itemTpl:['<div class="feed" style="background-image:url(resources/images/headshots/{avatar});"></div>',"{fullname}","<span>{studentid}-{group}C{course}-{email}</span>",].join(""),items:[{xtype:"listitemheader",cls:"dark",html:"Members"}],listeners:{itemtap:function(c,b,d,a){var e=c.getStore().getAt(b);Ext.Msg.alert("Test","Redirect to userid "+e.get("userid"))}}},{xtype:"list",itemId:"projectJobList",store:"Projectjobs",disclosure:true,onItemDisclosure:true,flex:1,cls:"x-feeds",itemTpl:['<div class="feed" style="background-image:url(resources/images/{status}.png);"></div>',"{name}","<span>{start_time} at {location}</span>",].join(""),items:[{xtype:"listitemheader",cls:"dark",html:"Jobs"}],listeners:{itemtap:function(c,b,e,a){var d=this.up("navigationview");d.push({xtype:"jobDetailsForm"})}}},]},initialize:function(){var a=Ext.data.StoreManager.lookup("Projectmembers");a.load({callback:function(c,b,d){},scope:this})}});Ext.define("Igor.view.task.ClassDetails",{extend:"Ext.Container",xtype:"classDetailsForm",itemId:"classDetailsForm",requires:["Ext.List","Igor.view.task.ProjectDetails","Igor.view.task.ClassTaskDetails","Igor.store.Classdetails","Igor.store.Classprojects","Igor.store.Classtasks"],config:{layout:"vbox",cls:"userInfo",title:"Class Detail",autoDestroy:true,items:[{xtype:"dataview",itemId:"classDetailPanel",flex:2,scrollable:true,store:"Classdetails",itemTpl:['<div class="header">','   <div class="avatar" style="background-image:url(resources/images/class-icon.png);"></div>',"   <h3>{subject_name}</h3>","   <h4>ID: {class_code}-Code: {subject_code}</h4>","</div>",'<div class="x-container x-form-fieldset nonEditable" style="padding: 1em;">','<div class="x-docking-vertical">','<div class="x-body">','<div class="x-inner x-form-fieldset-inner">','<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important;">',"<span>Session</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-text" type="text" value="{total_session}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field x-field-text x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Teacher</span>","</div>",'<div class="x-component-outer">','<div class="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="email" value="{teacher_name}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>",'<div class="x-container x-field-text x-field x-label-align-left x-field-labeled x-form-label-nowrap x-empty">','<div class="x-form-label" style="width: 30% !important; ">',"<span>Location</span>","</div>",'<div class="x-component-outer">','<divclass="x-field-input">','<input class="x-input-el x-form-field x-input-email" type="text" value="{location}">','<div class="x-field-mask" style="display: none !important; "></div>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"].join(""),},{xtype:"list",itemId:"classProjectList",disclosure:true,onItemDisclosure:true,flex:1,cls:"x-feeds",store:"Classprojects",itemTpl:['<div class="feed" style="background-image:url(resources/images/project_icon.png);"></div>',"{name}","<span>{description}</span>",].join(""),items:[{xtype:"listitemheader",cls:"dark",html:"Projects"}],listeners:{itemtap:function(c,b,e,a){var d=this.up("navigationview");d.push({xtype:"projectDetailsForm"})}}},{xtype:"list",itemId:"classTaskList",disclosure:true,onItemDisclosure:true,flex:1,cls:"x-feeds",store:"Classtasks",itemTpl:['<div class="feed" style="background-image:url(resources/images/{status}.png);"></div>',"{name}","<span>{start_time} at {location}</span>",].join(""),items:[{xtype:"listitemheader",cls:"dark",html:"Tasks"}]},]},initialize:function(){}});Ext.define("Igor.controller.Main",{extend:"Ext.app.Controller",requires:["Igor.view.task.NewProject","Igor.view.task.NewClassTask","Igor.view.task.ClassDetails","Igor.view.task.New","Igor.view.task.AddClass","Igor.utility.ux.PathMenu","Igor.utility.ux.AccordionList","Igor.view.task.SubjectDetails",],init:function(){},config:{control:{updatesList:{itemtap:"viewUpdateDetails",disclose:"viewUpdateDetails"},tasksListByDay:{itemtap:"viewTaskDetails",},userDetailsForm:{pop:"onProfilePop",},daySelBtn:{toggle:"onDayToggle",},tasksForm:{pop:"onTaskPop",push:"onTaskPush",initialize:"onTaskInit"},classDetailsForm:{initialize:"classDetailInit"},refreshNewsButton:{tap:"onNotificationInit"},updatesListForm:{initialize:"onNewsInit",},schedulerList:{itemtap:"onTaskTap",itemtaphold:"onTaskTapHold"},subjectSearch:{clearicontap:"onSearchClearIconTap",keyup:"onSearchKeyUp"},newProjectForm:{initialize:"onNewProjectInit"},mainPnl:{initialize:"onNotificationInit"},pathBtn:{itemtap:"onPathMenuItemTap"},saveUpdatedProfileBtn:{tap:"doSaveUpdatedProfile"},subjectList:{itemtap:"onSubjectTapHold"},saveClassTaskBtn:{tap:"doSaveNewClassTask"},saveProjectBtn:{tap:"doSaveNewProject"},classTaskList:{itemtap:"doClassTaskTap"},markCompletedBtn:{tap:"doSetCompletedMark"},deleteJobBtn:{tap:"doDeleteJob"}},routes:{updates:"doUpdates","updates/Update/:id":"viewUpdateDetails","tasks/:id":"doTasks","tasks/taskbyday/:day_of_week":"showTasksByDay","tasks/:id":"viewTaskDetails","user/:id":"viewUserDetails","user/frienddetails/:id":"viewFriendDetails","user/classdetails/:id":"viewClassDetails","classJobTaskDetails/:id":"viewJobTaskDetails"},refs:{pathBtn:"button[pathButtonType=menuitem]",newsPathItemBtn:"button[pathButtonType=menu]",refreshNewsButton:"updatesListForm #refreshNewsButton",updatesListForm:"updatesListForm",daySelBtn:"tasksForm #daySelectBtn",mainPnl:"mainpanel",newProjectForm:"newProjectForm",updatesList:"updatesListForm #updateList",saveProjectBtn:"newProjectForm #saveProjectBtn",classDetails:"classDetailsForm",schedulerList:"tasksForm #schedulerList",userListField:"newProjectForm #userListField",classTaskList:"classDetailsForm #classTaskList",newSchedulerForm:"newTask",subjectSearch:"newTask #subjectSearch",subjectList:"newTask #subjectList",tasksForm:"tasksForm",addTaskBtn:".tasksForm #addTaskBtn",tasksListByDay:"#tasksListByDay",termSelBtn:".tasksForm #termSelectBtn",userDetailsForm:"userDetailsForm",editProfileButton:"userDetailsForm #editProfileButton",profileEditForm:"profileEdit",saveUpdatedProfileBtn:"profileEdit #saveUpdatedProfileBtn",newClassTaskForm:"newClassTaskForm",saveClassTaskBtn:"newClassTaskForm #saveClassTaskBtn",jobDetailsForm:"jobDetailsForm",markCompletedBtn:"jobDetailsForm #markCompletedBtn",deleteJobBtn:"jobDetailsForm #deleteJobBtn"},before:{doTasks:["getCurrentTime","getAllTasksByUser"],},},testFunc:function(){var b=this.getMainPnl().getTabBar().getComponent(0)},onPathMenuItemTap:function(b,a){this.getMainPnl().setActiveItem(a.getItemId()-1)},onSearchKeyUp:function(f){var e=f.getValue(),b=this.getSubjectList().getStore();b.clearFilter();if(e){var d=e.split(" "),a=[],c;for(c=0;c<d.length;c++){if(!d[c]){continue}a.push(new RegExp(d[c],"i"))}b.filter(function(h){var g=[];for(c=0;c<a.length;c++){var j=a[c],i=h.get("subject_name").match(j)||h.get("subject_code").match(j);g.push(i)}if(a.length>1&&g.indexOf(false)!=-1){return false}else{return g[0]}})}},onSearchClearIconTap:function(){this.getSubjectList().getStore().clearFilter()},onNewsInit:function(){Ext.create("Igor.utility.ux.PathMenu",{bottom:10,left:window.innerWidth/2-15,items:[{iconCls:"chat_black2",cardIndex:0,itemId:5},{iconCls:"info",cardIndex:1,itemId:4},{iconCls:"team",cardIndex:2,itemId:3},{iconCls:"calendar2",cardIndex:3,itemId:2},{iconCls:"rss",cardIndex:4,itemId:1}]})},classDetailInit:function(){},onTaskTap:function(d,c,e,a){var b=Ext.ComponentQuery.query("#termSelectBtn")[0];window.location.href="index.html#tasks/"+a.get("class_id");b.hide()},onTaskTapHold:function(d,b,e,a){mainPnl=this.getMainPnl();var c=Ext.getStore("Users").getAt(0).get("userid");Ext.Msg.confirm("Delete","Are you sure you want to delete this scheduler ?",function(f){if(f==="yes"){mainPnl.setMasked({xtype:"loadmask",message:"Loading..."});Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/class_subject/call/jsonp/delete_class",params:{user_id:c,class_id:a.get("class_id")},disableCaching:false,success:function(g,h){mainPanel=Ext.ComponentQuery.query("mainpanel")[0];mainPanel.unmask();if(g.status="OK"){}}});console.log(a)}})},onTaskInit:function(){var b=this.getDaySelBtn();var a=new Date().getDay();if(a==0){b.setPressedButtons(6);this.showTasksByDay(6)}else{b.setPressedButtons(a-1);this.showTasksByDay(a-1)}this.getTermSelBtn().setHandler(function(){if(!this.picker){this.picker=Ext.Viewport.add({xtype:"picker",title:"Select Term",toolbar:{title:"Select Term"},slots:[{name:"term",title:"Term",data:[{text:"20111",value:20111},{text:"20112",value:20112},{text:"20113",value:20113},{text:"20121",value:20121},{text:"20123",value:20123}]}]})}this.picker.show()})},onNotificationInit:function(){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});var b=this.getNewsPathItemBtn().menuItems;var c=Ext.getStore("Users").getAt(0).get("userid");Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/notification/call/jsonp/get_all_notification",params:{owner:c,},disableCaching:false,success:function(d,f){mainPanel=Ext.ComponentQuery.query("mainpanel")[0];mainPanel.unmask();if(d.status="OK"){var g=Ext.getStore("Notifications"),a={},e=0;g.removeAll();Ext.Array.each(d.message,function(h){if(h.is_read==false){e++}if(h.avatar==null){h.avatar="default_male.png"}a=Ext.create("Igor.model.Notification",h);g.add(a);if(e!=0){}})}}})},onSubjectListInit:function(){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});var a=Ext.getStore("Users").getAt(0).get("userid");Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/subject/call/jsonp/get_all_subjects",disableCaching:false,success:function(b,e){mainPanel=Ext.ComponentQuery.query("mainpanel")[0];mainPanel.unmask();if(b.status="OK"){var d=Ext.getStore("Subjects"),f={},c=0;d.removeAll();Ext.Array.each(b.message,function(g){f=Ext.create("Igor.model.Subject",g);d.add(f)});Ext.ComponentQuery.query("#subjectList")[0].setRecord(d.data.all)}}})},onSelectClassesListInit:function(){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});Ext.data.JsonP.request({url:"https://igor-assistant-ca-2012.appspot.com/igor/class_subject/call/jsonp/get_classes_by_subject/",params:{subject_id:"4007",term:"",},disableCaching:false,success:function(a,e){mainPanel=Ext.ComponentQuery.query("mainpanel")[0];mainPanel.unmask();if(a.status="OK"){var b=Ext.getStore("Classdetails"),c={},d=0;b.removeAll();Ext.Array.each(a.message,function(f){c=Ext.create("Igor.model.Classdetail",f);b.add(c)});Ext.ComponentQuery.query("#selectClassesList")[0].setRecord(b.data.all)}}})},onNewProjectInit:function(){var b=this.getNewProjectForm().getClassid();var a=Ext.getStore("Classdetails").getAt(0).get("class_id");Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/get_users_by_class",params:{class_id:a,},disableCaching:false,success:function(c,d){mainPanel=Ext.ComponentQuery.query("mainpanel")[0];mainPanel.unmask();if(c.status="OK"){var e=Ext.getStore("Classusers"),f={};e.removeAll();Ext.Array.each(c.message,function(g){f=Ext.create("Igor.model.Classuser",g);e.add(f)})}}})},onDayToggle:function(a,c,d,b){if(d){window.location.href="index.html#tasks/taskbyday/"+c.getItemId()}else{}},onProfilePop:function(){var a=this.getEditProfileButton();a.show()},onTaskPop:function(){var c=this.getTasksForm();var b=c.getPreviousItem();var a=this.getAddTaskBtn();if(b==null){a.setHandler(function(){var e=this.up("navigationview");var d=Ext.ComponentQuery.query("#termSelectBtn")[0];e.push({xtype:"newTask"});this.hide();d.hide()});this.getTermSelBtn().show();a.show()}else{if(b.getItemId().indexOf("scheduler")!=-1){a.show();a.setHandler(this.getFuncForAddBtn("class"))}else{if(b.getItemId().indexOf("classDetailsForm")!=-1){a.show();a.setHandler(this.getFuncForAddBtn("project"))}}}},onTaskPush:function(){var a=this.getTasksForm();var b=a.getActiveItem();if(b.getItemId().indexOf("classDetailsForm")!=-1){this.getAddTaskBtn().setHandler(this.getFuncForAddBtn("class"))}else{if(b.getItemId().indexOf("projectDetailsForm")!=-1){this.getAddTaskBtn().setHandler(this.getFuncForAddBtn("project"))}else{if(b.getItemId().indexOf("classTaskDetailsForm")!=-1){this.getAddTaskBtn().hide()}else{if(b.getItemId().indexOf("jobDetailsForm")!=-1){this.getAddTaskBtn().hide()}else{if(b.getItemId().indexOf("newTask")!=-1){this.onSubjectListInit();this.getSubjectList().setStore("Subject");this.getTermSelBtn().hide()}else{if(b.getItemId().indexOf("addclassForm")!=-1){this.onSelectClassesListInit();this.getNewClassForm().setStore("Classdetails");this.getTermSelBtn().hide()}}}}}}},viewUpdateDetails:function(c,b,d,a){var e=c.getStore().getAt(b);window.location.href="index.html#classJobTaskDetails/"+e.get("objectid");this.getUpdatesListForm().push({xtype:"jobDetailsForm"})},doTasks:function(){this.showTasksByUser()},getAllTasksByUser:function(a){},getCurrentTime:function(){},showTasksByUser:function(){},showTasksByDay:function(a){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});var b=Ext.getStore("Users").getAt(0).get("userid");Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/class_subject/call/jsonp/get_classes_by_user_time",params:{user_id:b,day_of_week:a},disableCaching:false,success:function(c,f){Ext.ComponentQuery.query("mainpanel")[0].unmask();if(c.status="OK"){var d=Ext.getStore("Tasks"),e={};d.removeAll();Ext.Array.each(c.message,function(g){e=Ext.create("Igor.model.Task",g);d.add(e)})}}})},viewTaskDetails:function(b){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/class_subject/call/jsonp/get_class_detail",params:{id:b},disableCaching:false,success:function(c,f){Ext.ComponentQuery.query("mainpanel")[0].unmask();if(c.status="OK"){var d=Ext.getStore("Classdetails"),e={};d.removeAll();Ext.Array.each(c.message,function(g){e=Ext.create("Igor.model.Classdetail",g);d.add(e)});Ext.ComponentQuery.query("tasksForm")[0].push({xtype:"classDetailsForm"})}}});Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/project/call/jsonp/get_project_by_class/",params:{class_id:b},disableCaching:false,success:function(c,e){var d=Ext.getStore("Classprojects"),f={};d.removeAll();d.sync();if(c.status=="OK"&&c.message!=""){Ext.Array.each(c.message,function(g){f=Ext.create("Igor.model.Classproject",g);d.add(f);d.sync()})}}});var a=Ext.getStore("Users").getAt(0).get("userid");Ext.data.JsonP.request({url:"https://igor-assistant-ca-2012.appspot.com/igor/jobs/call/jsonp/get_jobs_by_class/",params:{user_id:a,class_id:b},disableCaching:false,success:function(c,d){var f=Ext.getStore("Classtasks"),e={};f.removeAll();f.sync();if(c.status=="OK"&&c.message!=""){Ext.Array.each(c.message,function(g){e=Ext.create("Igor.model.Classtask",g);f.add(e);f.sync()})}}})},viewUserDetails:function(a){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/get_user_detail",params:{id:a},disableCaching:false,success:function(b,e){Ext.ComponentQuery.query("mainpanel")[0].unmask();if(b.status="OK"){var c=Ext.getStore("Profiles"),d={};c.removeAll();Ext.Array.each(b.message,function(f){d=Ext.create("Igor.model.Profile",f);c.add(d)})}}})},getUserDetails:function(a){},getClassesListByUser:function(a){},viewClassDetails:function(a){this.redirectTo("url")},getFuncForAddBtn:function(c){var a=this.getTasksForm();var b=a.getActiveItem();if(c=="class"){return function(){this.actions=Ext.Viewport.add({xtype:"actionsheet",items:[{text:"Add New Project",scope:this,handler:function(){a.push({xtype:"newProjectForm"});this.hide();this.actions.hide()}},{text:"Add New Task",scope:this,handler:function(){a.push({xtype:"newClassTaskForm"});this.hide();this.actions.hide()}},{xtype:"button",text:"Cancel",scope:this,handler:function(){this.actions.hide()}}]});this.actions.show()}}else{if(c=="project"){return function(){this.actions=Ext.Viewport.add({xtype:"actionsheet",items:[{text:"Add New Member",scope:this,handler:function(){a.push({xtype:"newProjectForm"});this.hide();this.actions.hide()}},{text:"Add New Job",scope:this,handler:function(){a.push({xtype:"newClassTaskForm"});this.hide();this.actions.hide()}},{xtype:"button",text:"Cancel",scope:this,handler:function(){this.actions.hide()}}]});this.actions.show()}}}},doSaveUpdatedProfile:function(){var d=Ext.getStore("Users").getAt(0).get("userid");var g=this.getProfileEditForm().getValues();var a=g.fullname;var f=g.studentid;var b=g.course;var e=g.group;var c=g.avatarPath;if(a!=""&&f!=""){Ext.data.JsonP.request({url:"https://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/update_user_detail/",params:{user_id:d,name:a,class_group:e,student_code:f,user_course:b,avatar:c},disableCaching:false,success:function(h,j){if(h.status=="OK"&&h.message!=""){var i=Ext.getStore("Users"),k={};i.removeAll();i.sync();Ext.Array.each(h.message,function(l){k=Ext.create("Igor.model.User",l);k.set("loggedIn",true);i.add(k);i.sync()});Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"))}else{Ext.Msg.alert("Failed updating!")}}})}else{Ext.Msg.alert("Not enough information!")}},onSubjectTapHold:function(c,b,d,a){window.location.href="index.html#subjectDetails/"+a.get("subject_id");this.getTasksForm().push({xtype:"subjectDetailsForm"})},doSaveNewClassTask:function(){var d=this.getNewClassTaskForm().getValues();var a=d.name;var k=d.location;var j=d.note;var c=d.startdate;var b=d.starttime;var f=d.enddate;var g=d.endtime;var h=Ext.getStore("Users").getAt(0).get("userid");var l=window.location.href;var e=l.split("#",2)[1];var i=e.split("/",2)[1];if(a!=""&&k!=""){Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/jobs/call/jsonp/add_class_job/",params:{user_id:h,name:a,job_type:0,note:j,location:k,class_id:i},disableCaching:false,success:function(m,o){if(m.status=="OK"&&m.message!=""){var n=Ext.getStore("Classtasks"),p={};n.sync();Ext.Array.each(m.message,function(q){p=Ext.create("Igor.model.Classtask",q);n.add(p);n.sync()});Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"))}else{Ext.Msg.alert("Failed! Try again!")}}})}else{Ext.Msg.alert("Not enough information!")}},doSaveNewProject:function(){var a=this.getNewProjectForm().getValues();var c=a.name;var b=a.description;if(c!=""&&b!=""){}else{Ext.Msg.alert("Not enough information!")}},doClassTaskTap:function(c,b,d,a){window.location.href="index.html#classJobTaskDetails/"+a.get("id");this.getTasksForm().push({xtype:"jobDetailsForm"})},viewJobTaskDetails:function(a){this.getMainPnl().setMasked({xtype:"loadmask",message:"Loading..."});Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/jobs/call/jsonp/get_jobs_detail/",params:{job_id:a},disableCaching:false,success:function(b,e){Ext.ComponentQuery.query("mainpanel")[0].unmask();if(b.status="OK"&&b.message!=""){var c=Ext.getStore("Classtasks"),d={};c.removeAll();c.sync();Ext.Array.each(b.message,function(f){d=Ext.create("Igor.model.Classtask",f);c.add(d);c.sync()})}}})},doSetCompletedMark:function(){var b=window.location.href;var c=b.split("#",2)[1];var a=c.split("/",2)[1];Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/jobs/call/jsonp/mark_job_finished/",params:{job_id:a},disableCaching:false,success:function(d,e){if(d.status="OK"&&d.message!=""){Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"))}else{Ext.Msg.alert("Failed! Try again!")}}})},doDeleteJob:function(){var b=window.location.href;var c=b.split("#",2)[1];var a=c.split("/",2)[1];Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/jobs/call/jsonp/delete_job/",params:{job_id:a},disableCaching:false,success:function(d,e){if(d.status="OK"&&d.message!=""){Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"))}else{Ext.Msg.alert("Failed! Try again!")}}})}});Ext.define("Igor.view.task.Task",{extend:"Ext.NavigationView",xtype:"tasksForm",requires:["Ext.List","Ext.Container","Igor.view.task.ClassDetails","Igor.view.task.New"],config:{autoDestroy:true,navigationBar:{defaults:{hideAnimation:Ext.os.is.Android?false:{type:"fadeOut",duration:200},showAnimation:Ext.os.is.Android?false:{type:"fadeIn",duration:200}},items:[{xtype:"button",itemId:"termSelectBtn",iconCls:"doc_drawer",iconMask:true,ui:"plain",align:"right",},{xtype:"button",itemId:"addTaskBtn",iconCls:"add",iconMask:true,ui:"plain",align:"right",handler:function(){var b=this.up("navigationview");var a=Ext.ComponentQuery.query("#termSelectBtn")[0];b.push({xtype:"newTask"});this.hide();a.hide()}}]},items:[{xtype:"list",itemId:"schedulerList",ui:"round",title:"Schedulers",itemTpl:"{title}",limit:5,store:"Tasks",grouped:true,itemTpl:['<div class="class"><div class="title">{subject_name}</div>','<div class="session">{total_session}</div></div>','<span style="font-size: 70%">{location}</span>'].join(""),items:[{docked:"top",xtype:"toolbar",scrollable:"horizontal",items:[{defaults:{cls:"x-phapphui-in"},style:{width:"100%",transition:"width 10s","-webkit-transition":"width 10s"},xtype:"segmentedbutton",itemId:"daySelectBtn",allowDepress:true,layout:{pack:"center",align:"center"},items:[{text:"Monday",itemId:"0",pressed:true},{text:"Tuesday",itemId:"1",},{text:"Wednesday",itemId:"2",},{text:"Thursday",itemId:"3",},{text:"Friday",itemId:"4",},{text:"Saturday",itemId:"5",},{text:"Sunday",itemId:"6",}],}]}],}]}});Ext.define("Igor.view.Main",{extend:"Ext.Panel",xtype:"mainpanel",requires:["Igor.view.notification.News","Igor.view.profile.Profile","Igor.view.task.Task","Igor.view.task.AddClass","Igor.view.about.About",],config:{fullscreen:true,ui:"dark",layout:{animation:"slide",type:"card"},items:[{title:"News",iconCls:"rss",cls:"news",xtype:"updatesListForm"},{xtype:"tasksForm",title:"Scheduler",iconCls:"calendar2",cls:"task"},{title:"Me",iconCls:"team",cls:"profile",xtype:"userDetailsForm",},{title:"About",iconCls:"info",cls:"about",xtype:"aboutPage"},{xtype:"formpanel",title:"Contact",iconCls:"chat_black2",layout:"vbox",items:[{xtype:"fieldset",title:"Contact Us",instructions:"Email address is optional",items:[{xtype:"textfield",label:"Name",name:"name"},{xtype:"emailfield",label:"Email",name:"email"},{xtype:"textareafield",label:"Message",name:"message",height:90}]},{xtype:"button",text:"Send",ui:"confirm",}]}]}});Ext.define("Igor.controller.Login",{extend:"Ext.app.Controller",views:["authenticate.Authenticate"],requires:["Igor.view.Main","Igor.view.authenticate.Register"],init:function(){},config:{control:{submitButton:{tap:"doLogin"},authenForm:{initialize:"checkSession"},registerButton:{tap:"doRegister"}},routes:{login:"doLogin"},refs:{authenForm:"authenForm",loginForm:"authenForm #loginForm",submitButton:"authenForm #submitBtn",registerButton:"authenForm #registerBtn"},before:{}},checkSession:function(){var a=Ext.getStore("Users");this.getAuthenForm().onAfter("erased",function(){this.destroy()});a.load({callback:function(c,b,d){if(c!=null&&a.first()!==undefined){Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"),{type:"slide"})}},scope:this})},doLogin:function(){var c=this.getLoginForm().getValues();var b=c.email;var a=c.password;if(b!=""&&a!=""){this.communicatingServer(b,a)}else{Ext.Msg.alert("Invalid Email or Password!")}},communicatingServer:function(b,a){Ext.data.JsonP.request({url:"http://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/login/",params:{email:b,password:a},disableCaching:false,success:function(c,e){if(c.status=="OK"&&c.message!=="Authentication failed! Check your email or password again"){var d=Ext.getStore("Users"),f={};d.removeAll();d.sync();Ext.Array.each(c.message,function(g){g.avatar="default_male.png";f=Ext.create("Igor.model.User",g);f.set("loggedIn",true);d.add(f);d.sync()});Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"))}else{Ext.Msg.alert("Invalid Email or Password!")}}})},doRegister:function(){this.getAuthenForm().push({xtype:"registerForm"})}});Ext.define("Igor.controller.Register",{extend:"Ext.app.Controller",views:["authenticate.Register"],requires:["Igor.view.Main"],init:function(){},config:{control:{submitRegisterBtn:{tap:"doRegister"}},routes:{register:"doRegister"},refs:{registerForm:"registerForm",submitRegisterBtn:"registerForm #submitRegisterBtn"},before:{}},doRegister:function(){var g=this.getRegisterForm().getValues();var b=g.fullname;var h=g.email;var a=g.password;var e=g.studentid;var c=g.course;var d=g.group;var f="http://igor-assistant-ca-2012.appspot.com/igor/static/images/igor.jpg";if(h!=""&&a!=""){this.sendRegisterRequest(h,a,b,d,e,c,f)}else{Ext.Msg.alert("Not enough information!")}},sendRegisterRequest:function(g,c,a,b,e,f,d){Ext.data.JsonP.request({url:"https://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/check_email_available/",params:{email:g},disableCaching:false,success:function(h,i){if(h.status=="OK"&&h.message=="1"){Ext.data.JsonP.request({url:"https://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/register/",params:{email:g,password:c,name:a,class_group:b,student_code:e,user_course:f,avatar:d},disableCaching:false,success:function(j,l){if(j.status=="OK"&&j.message!=""){var k=j.message;Ext.data.JsonP.request({url:"https://igor-assistant-ca-2012.appspot.com/igor/user/call/jsonp/get_user_detail/",params:{id:k},disableCaching:false,success:function(m,o){if(m.status=="OK"&&m.message!=""){var n=Ext.getStore("Users"),p={};n.removeAll();n.sync();Ext.Array.each(m.message,function(q){if(q.avatar==""){q.avatar="default_male.png"}p=Ext.create("Igor.model.User",q);p.set("loggedIn",true);n.add(p);n.sync()});Ext.Viewport.setActiveItem(Ext.create("Igor.view.Main"))}else{Ext.Msg.alert("Failed Registering!")}}})}else{Ext.Msg.alert("Failed Registering!")}}})}else{Ext.Msg.alert("Email Address existed!")}}})}});Ext.Loader.setConfig({disableCaching:false});Ext.application({name:"Igor",requires:["Ext.MessageBox"],controllers:["Main","ClassDetails","Login","Register","SubjectDetails","ClassDetails"],views:["Main","authenticate.Authenticate","authenticate.Register"],stores:["Notifications","Users","Profiles","Tasks","Classdetails","Classprojects","Classtasks","Projectmembers","Projectjobs","Classusers","Subjects","SubjectDetails","SubjectClasses"],models:["Notification","User","Task","Classdetail","Classproject","Classtask","Projectjob","Projectmember","Classuser","Profile","Subject","ClassOfSubject"],icon:{57:"resources/icons/Icon.png",72:"resources/icons/icon@72.png",114:"resources/icons/Icon@2x.png",144:"resources/icons/icon@114.png"},phoneStartupScreen:"resources/loading/Default.jpg",tabletStartupScreen:"resources/loading/Default~ipad.jpg",launch:function(){Ext.fly("appLoadingIndicator").destroy();Ext.Viewport.add({xclass:"Igor.view.authenticate.Authenticate"})},onUpdated:function(){Ext.Msg.confirm("Application Update","This application has just successfully been updated to the latest version. Reload now?",function(a){if(a==="yes"){window.location.reload()}})}});